<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JA Trader Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { background: #121212; color: white; font-family: Arial; padding: 20px; }
    .input, button { padding: 8px; margin: 5px; border-radius: 5px; }
    .btn { padding: 10px 15px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .error { color: red; }
    .success { color: green; }
    .card { background: #1f1f1f; padding: 10px; margin-top: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Welcome to JA Broker Trader Panel</h2>
  <div>
    <input id="username" placeholder="Username" class="input" />
    <input id="password" placeholder="Password" class="input" />
    <button onclick="login()" class="btn">Login</button>
  </div>

  <div id="panel" style="display:none;">
    <h3>Balance: ₹<span id="balance">0</span></h3>
    <input id="qty" type="number" placeholder="Quantity" class="input" />
    <input id="entry" type="number" placeholder="Entry Price" class="input" />
    <select id="type" class="input">
      <option value="buy">Buy</option>
      <option value="sell">Sell</option>
    </select>
    <button onclick="placeTrade()" class="btn">Place Trade</button>
    <div id="message" class="error"></div>
    <h4>Trade History</h4>
    <div id="history"></div>
  </div>

  <script>
    const config = {
      apiKey: "AIzaSyAr63v10I56cCghOTrGV_KhjQ69HnyaP3Q",
      authDomain: "brokerja-74512.firebaseapp.com",
      databaseURL: "https://brokerja-74512-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "brokerja-74512",
      storageBucket: "brokerja-74512.appspot.com",
      messagingSenderId: "1048821297447",
      appId: "1:1048821297447:web:b8a1e2c43b8ed8333b3902"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    let currentUser = "";

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      db.ref("users/" + u).once("value", snap => {
        const user = snap.val();
        if (user && user.password === p) {
          currentUser = u;
          document.getElementById("panel").style.display = "block";
          updateBalance();
          loadTrades();
        } else {
          alert("Invalid credentials");
        }
      });
    }

    function updateBalance() {
      db.ref("users/" + currentUser + "/balance").on("value", snap => {
        document.getElementById("balance").innerText = parseFloat(snap.val()).toFixed(2);
      });
    }

    function placeTrade() {
      const qty = parseFloat(document.getElementById("qty").value);
      const entry = parseFloat(document.getElementById("entry").value);
      const type = document.getElementById("type").value;
      if (isNaN(qty) || isNaN(entry)) {
        document.getElementById("message").innerText = "Please fill all fields.";
        return;
      }

      db.ref("users/" + currentUser + "/balance").once("value", snap => {
        const balance = parseFloat(snap.val());
        if (balance < 5.1) {
          document.getElementById("message").innerText = "❌ Insufficient balance to trade (min ₹5.1 required)";
          return;
        }

        const id = Date.now().toString();
        const trade = {
          qty,
          entry,
          type,
          status: "open",
          timestamp: Date.now()
        };
        db.ref("users/" + currentUser + "/trades/" + id).set(trade);
        document.getElementById("message").innerText = "✅ Trade placed successfully.";
        loadTrades();
      });
    }

    function loadTrades() {
      db.ref("users/" + currentUser + "/trades").on("value", snap => {
        const trades = snap.val();
        const container = document.getElementById("history");
        container.innerHTML = "";
        if (!trades) {
          container.innerHTML = "No trades yet.";
          return;
        }
        for (let id in trades) {
          const t = trades[id];
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <b>${t.type.toUpperCase()}</b> | Qty: ${t.qty} | Entry: ₹${t.entry} <br>
            Status: ${t.status} ${t.pnl !== undefined ? `| PNL: ₹${parseFloat(t.pnl).toFixed(2)}` : ""}
          `;
          container.appendChild(div);
        }
      });
    }
  </script>
</body>
</html>




